!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Mars||(t.Mars={})).React=e()}}(function(){return function e(t,n,r){function o(i,u){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!u&&s)return s(i,!0);if(a)return a(i,!0);var f=new Error("Cannot find module '"+i+"'");throw f.code="MODULE_NOT_FOUND",f}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=e("react"),c=r(f),l=function(e){function t(e,n){o(this,t);var r=a(this,Object.getPrototypeOf(t).call(this,e,n));return r.state={result:{}},r.query=e.component.getQuery(e.variables),r.query.on("update",r._handleDataChanges.bind(r)),r._executeQuery(),r}return i(t,e),s(t,[{key:"_executeQuery",value:function(){var e=this;this._resolved=!1,this.query.execute().then(function(t){e._resolved=!0,e.setState({result:t})})}},{key:"_handleDataChanges",value:function(e){this._resolved&&this.setState({result:e})}},{key:"componentWillUnmount",value:function(){this.query.stop()}},{key:"componentWillReceiveProps",value:function(e){this.query.updateVariables(e)}},{key:"renderLoading",value:function(){return this.props.renderLoading()}},{key:"render",value:function(){var e=this.props.component;return this._resolved?c["default"].createElement(e,u({},this.props,this.state.result)):this.renderLoading()}}]),t}(c["default"].Component);l.defaultProps={renderLoading:function(){return null}},n["default"]=l},{react:void 0}],2:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=e("fast.js/forEach"),c=o(f),l=e("fast.js/map"),p=o(l),d=e("fast.js/object/keys"),v=o(d),h=e("marsdb"),y=e("invariant"),m=o(y),b=e("./utils"),g=r(b),C=function(e){function t(){var e=arguments.length<=0||void 0===arguments[0]?new Map:arguments[0];a(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.variables=e,n.emitCleanup=n.emitCleanup.bind(n),n}return u(t,e),s(t,[{key:"addCleanupListener",value:function(e){var t=this;return this.on("cleanup",e),function(){return t.removeListener("cleanup",e)}}},{key:"emitCleanup",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];this.emit("cleanup",e)}},{key:"createChildContext",value:function(){var e=new t(this.variables),n=this.addCleanupListener(function(t){e.emitCleanup(!1),t||n()});return e}},{key:"withinContext",value:function(e){var n=t.getCurrentContext();t.__currentContext=this;try{return e()}finally{t.__currentContext=n}}},{key:"getVariables",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=arguments.length<=3||void 0===arguments[3]?null:arguments[3],o=this.variables.get(e);o||(o={},this.variables.set(e,o));for(var a in t)void 0===o[a]&&(void 0!==n[a]?((0,m["default"])(g._isProperty(n[a]),"You can pass to a mapping only parent variables"),o[a]=n[a]):o[a]=g._createProperty(t[a]));return r&&!o.promise&&Object.defineProperty(o,"promise",{value:Promise.resolve(r(o)),configurable:!0}),o}},{key:"trackVariablesChange",value:function(e,t,n){var r=this,o=function(){r.emitCleanup(),e.promise&&e.promise.stop&&e.promise.stop();var o=r.withinContext(function(){return n(t)});if(g._isCursor(o))r.trackCursorChange(e,o),e.emitChange();else{if(g._isProperty(o))throw new Error("Next value can't be a property");e(o)}},a=(0,p["default"])((0,v["default"])(t),function(e){return t[e].addChangeListener(o)}),i=this.addCleanupListener(function(e){e||((0,c["default"])(a,function(e){return e()}),i())})}},{key:"trackCursorChange",value:function(e,t){var n=this;e.removeCursorTracker&&e.removeCursorTracker();var r=function(t){Array.isArray(t)&&(t=(0,p["default"])(t,function(e){return g._createPropertyWithContext(e,n)})),e(t)};t.on("cursorChanged",this.emitCleanup),e.promise=t.observe(r),e.removeCursorTracker=function(){t.removeListener("cursorChanged",n.emitCleanup),e.promise.stop()};var o=this.addCleanupListener(function(t){t||(e.removeCursorTracker(),o())})}}],[{key:"getCurrentContext",value:function(){return t.__currentContext}}]),t}(h.EventEmitter);n["default"]=C},{"./utils":5,"fast.js/forEach":9,"fast.js/map":11,"fast.js/object/keys":14,invariant:16,marsdb:void 0}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("fast.js/object/keys"),f=r(s),c=e("fast.js/forEach"),l=r(c),p=e("fast.js/map"),d=r(p),v=e("marsdb"),h=e("invariant"),y=r(h),m=e("./ExecutionContext"),b=r(m),g=function(e){function t(e,n,r,i){o(this,t);var u=a(this,Object.getPrototypeOf(t).call(this));return u.containerClass=r,u.fragmentNames=(0,f["default"])(e),u.initVarsOverride=n,u.context=new b["default"],u.variables=u.context.getVariables(r,n,{},i),u._handleDataChanges=(0,v.debounce)(u._handleDataChanges.bind(u),1e3/60,5),u}return i(t,e),u(t,[{key:"batchSize",value:function(e){return this._handleDataChanges.updateBatchSize(e),this}},{key:"debounce",value:function(e){return this._handleDataChanges.updateWait(e),this}},{key:"execute",value:function(){var e=this;return this._execution||!function(){e.result={},e.context.withinContext(function(){(0,l["default"])(e.fragmentNames,function(t){e.result[t]=e.containerClass.getFragment(t)})});var t=function(){e._execution=e._handleDataChanges()};e._stoppers=(0,d["default"])(e.fragmentNames,function(n){return e.result[n].addChangeListener(t)}),t()}(),this._execution}},{key:"stop",value:function(){var e=this;return(0,y["default"])(this._execution,"stop(...): query is not executing"),this.removeAllListeners(),this._execution.then(function(){(0,l["default"])(e._stoppers,function(e){return e()}),e.context.emitCleanup(),e._execution=null})}},{key:"updateVariables",value:function(e){var t=this;return(0,y["default"])(this._execution,"updateVariables(...): query is not executing"),this._execution.then(function(){var n=!1;return(0,l["default"])(e,function(e,r){t.variables[r]&&(t.variables[r](e),n=!0)}),n})}},{key:"_handleDataChanges",value:function(){var e=this,t=(0,d["default"])(this.fragmentNames,function(t){return e.result[t].promise}),n=Promise.all(t).then(function(){return e._resultPromise===n&&e.emit("update",e.result),e.result},function(t){return e.emit("error",t),e.result});return this._resultPromise=n,this._resultPromise}}]),t}(v.EventEmitter);n["default"]=g},{"./ExecutionContext":2,"fast.js/forEach":9,"fast.js/map":11,"fast.js/object/keys":14,invariant:16,marsdb:void 0}],4:[function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}function o(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){var n=t.fragments,r=void 0===n?{}:n,o=t.initialVariables,s=void 0===o?{}:o,p=t.prepareVariables,v=void 0===p?null:p,y=e.displayName||e.name,b="Mars("+y+")",C=(0,d["default"])(r),j=function(t){function n(){return a(this,n),i(this,Object.getPrototypeOf(n).apply(this,arguments))}return u(n,t),l(n,[{key:"render",value:function(){var t=this.props[C[0]].context.getVariables(n);return m["default"].createElement(e,c({},this.props,{variables:t}))}}],[{key:"getFragment",value:function(e,t){var o=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],a=arguments[3];a=a||_["default"].getCurrentContext(),(0,g["default"])(a,"getFragment(...): must be invoked within some context");var i=a.createChildContext(),u=r[e],c=(0,h["default"])({},s,o),l=i.getVariables(n,c,t,v);return(0,g["default"])("function"==typeof u||"object"===("undefined"==typeof u?"undefined":f(u)),"getFragment(...): a fragment must be a function or an object"),"object"===("undefined"==typeof u?"undefined":f(u))?w._getJoinFunction(n,u,l,i):w._getFragmentValue(n,u,l,i)}},{key:"getQuery",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=(0,h["default"])({},s,e);return new x["default"](r,t,n,v)}}]),n}(m["default"].Component);return j.displayName=b,j}Object.defineProperty(n,"__esModule",{value:!0});var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n["default"]=s;var p=e("fast.js/object/keys"),d=o(p),v=e("fast.js/object/assign"),h=o(v),y=e("react"),m=o(y),b=e("invariant"),g=o(b),C=e("./ExecutionContext"),_=o(C),j=e("./QueryExecutor"),x=o(j),O=e("./utils"),w=r(O)},{"./ExecutionContext":2,"./QueryExecutor":3,"./utils":5,"fast.js/object/assign":12,"fast.js/object/keys":14,invariant:16,react:void 0}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return"function"==typeof e&&!!e.isProperty}function a(e){return e instanceof g["default"]}function i(e,t,n,r){var i=function(){var e=r.withinContext(function(){return t(n)}),i=void 0;return o(e)?i=e:(i=f(null,r),a(e)?r.trackCursorChange(i,e):i(e),r.trackVariablesChange(i,n,t)),i};if(!n.promise)return i();var u=function(){var e=f(null,r);return e.promise=n.promise.then(function(){var t=i();return null!==t()&&e.emitChange(),e.proxyTo(t),t.promise}),{v:e}}();return"object"===("undefined"==typeof u?"undefined":c(u))?u.v:void 0}function u(e,t,n,r){var o=(0,y["default"])(t);return function(a){var u=arguments.length<=1||void 0===arguments[1]?_:arguments[1];return"object"===("undefined"==typeof a?"undefined":c(a))&&null!==a?(0,v["default"])(o,function(o){if(void 0===a[o]){var s=function(){var s=function(e){return t[o](a,e)},f=i(e,s,n,r);return a[o]=f,{v:Promise.resolve(f.promise).then(function(e){var t=f.addChangeListener(u),n=r.addCleanupListener(function(e){e||(n(),t())});return e})}}();if("object"===("undefined"==typeof s?"undefined":c(s)))return s.v}}):void 0}}function s(e){var t=new m.EventEmitter,n=e,r=null,o=function a(){return r?r.apply(null,arguments):(arguments.length>0&&(n=arguments[0],1===arguments.length&&a.emitChange()),n)};return o.emitChange=function(){o.version=++C,t.emit("change")},o.addChangeListener=function(e){return t.on("change",e),function(){t.removeListener("change",e)}},o.proxyTo=function(e){r=e,Object.defineProperty(o,"version",{get:function(){return e.version},set:function(t){return e.version=t}}),o.addChangeListener=e.addChangeListener,o.emitChange=e.emitChange,(0,p["default"])(t.listeners("change"),function(t){return e.addChangeListener(t)}),t=null,n=null},o.version=++C,o.isProperty=!0,o}function f(e,t){var n=s(e);return n.context=t,n}Object.defineProperty(n,"__esModule",{value:!0}),n.noop=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n._isProperty=o,n._isCursor=a,n._getFragmentValue=i,n._getJoinFunction=u,n._createProperty=s,n._createPropertyWithContext=f;var l=e("fast.js/forEach"),p=r(l),d=e("fast.js/map"),v=r(d),h=e("fast.js/object/keys"),y=r(h),m=e("marsdb"),b=e("marsdb/dist/CursorObservable"),g=r(b),C=0,_=n.noop=function(){}},{"fast.js/forEach":9,"fast.js/map":11,"fast.js/object/keys":14,marsdb:void 0,"marsdb/dist/CursorObservable":void 0}],6:[function(e,t,n){var r=e("./dist/createContainer")["default"],o=e("./dist/DataManagerContainer")["default"];t.exports={__esModule:!0,createContainer:r,DataManagerContainer:o}},{"./dist/DataManagerContainer":1,"./dist/createContainer":4}],7:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,a=e.length,i=void 0!==n?r(t,n):t;for(o=0;a>o;o++)i(e[o],o,e)}},{"../function/bindInternal3":10}],8:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,a=e.length,i=new Array(a),u=void 0!==n?r(t,n):t;for(o=0;a>o;o++)i[o]=u(e[o],o,e);return i}},{"../function/bindInternal3":10}],9:[function(e,t,n){"use strict";var r=e("./array/forEach"),o=e("./object/forEach");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):o(e,t,n)}},{"./array/forEach":7,"./object/forEach":13}],10:[function(e,t,n){"use strict";t.exports=function(e,t){return function(n,r,o){return e.call(t,n,r,o)}}},{}],11:[function(e,t,n){"use strict";var r=e("./array/map"),o=e("./object/map");t.exports=function(e,t,n){return e instanceof Array?r(e,t,n):o(e,t,n)}},{"./array/map":8,"./object/map":15}],12:[function(e,t,n){"use strict";t.exports=function(e){var t,n,r,o,a,i,u=arguments.length;for(n=1;u>n;n++)for(t=arguments[n],o=Object.keys(t),r=o.length,i=0;r>i;i++)a=o[i],e[a]=t[a];return e}},{}],13:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,a,i=Object.keys(e),u=i.length,s=void 0!==n?r(t,n):t;for(a=0;u>a;a++)o=i[a],s(e[o],o,e)}},{"../function/bindInternal3":10}],14:[function(e,t,n){"use strict";t.exports="function"==typeof Object.keys?Object.keys:function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],15:[function(e,t,n){"use strict";var r=e("../function/bindInternal3");t.exports=function(e,t,n){var o,a,i=Object.keys(e),u=i.length,s={},f=void 0!==n?r(t,n):t;for(o=0;u>o;o++)a=i[o],s[a]=f(e[a],a,e);return s}},{"../function/bindInternal3":10}],16:[function(e,t,n){"use strict";var r=function(e,t,n,r,o,a,i,u){if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var f=[n,r,o,a,i,u],c=0;s=new Error(t.replace(/%s/g,function(){return f[c++]})),s.name="Invariant Violation"}throw s.framesToPop=1,s}};t.exports=r},{}]},{},[6])(6)});